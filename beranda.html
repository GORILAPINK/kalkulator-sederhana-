<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>💖 Sweet Wallet Compact 💖</title>

<!-- Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;600&display=swap');

body {font-family:'Poppins',sans-serif;background:#ffe6f2;margin:0;padding:0;text-align:center;color:#333;}
h1 {font-family:'Pacifico',cursive;color:#e75480;font-size:1.6em;margin:12px 0;}
.container {max-width:360px;margin:auto;background:#fff;border-radius:15px;padding:10px;box-shadow:0 4px 12px rgba(231,84,128,0.3);}

form {display:flex;flex-wrap:wrap;justify-content:center;gap:4px;margin-bottom:10px;}
input {padding:5px 8px;border-radius:8px;border:1px solid #e75480;font-size:12px;min-width:100px;}
button {padding:4px 8px;border-radius:8px;border:none;background:linear-gradient(45deg,#ff69b4,#e75480);color:#fff;font-weight:bold;cursor:pointer;transition:.3s;font-size:12px;}
button:hover {transform:scale(1.05);background:linear-gradient(45deg,#e75480,#ff69b4);}

/* Ringkasan */
.summary {display:flex;justify-content:space-around;flex-wrap:wrap;gap:4px;margin-bottom:10px;}
.summary-box {flex:1;min-width:120px;background:#ffe4e1;color:#e75480;border-radius:10px;padding:5px;font-size:11px;font-weight:bold;box-shadow:0 2px 5px rgba(231,84,128,0.4);}

/* Grafik & Tabel */
.section-container {display:flex;gap:8px;flex-direction:column;margin-bottom:10px;}
.section-box {flex:1;background:#fff0f7;border-radius:10px;padding:8px;box-shadow:0 2px 5px rgba(231,84,128,0.2);}
.table-wrapper {width:100%;overflow-x:auto;}
table {width:100%;border-collapse:collapse;margin-top:3px;font-size:10px;}
th,td {padding:3px;text-align:center;}
th {background:#ff69b4;color:#fff;}
tr:nth-child(even){background:#ffe6f2;}

canvas {width:100%!important;height:120px!important;margin-top:3px;}

/* Tombol Ekspor */
.btn-group {margin-top:5px;display:flex;flex-wrap:wrap;justify-content:center;gap:3px;}
.btn-group button {background:#ffb6c1;color:#fff;font-size:11px;padding:3px 6px;}
.btn-group button.shareimage {background:#8b0000;}

/* Tombol Aksi di tabel */
.tabel-btn {padding:2px 5px;border:none;border-radius:12px;margin:1px;font-size:9px;cursor:pointer;font-weight:bold;transition:0.3s;}
.tabel-btn.edit {background:#ff69b4;color:#fff;}
.tabel-btn.hapus {background:#ffb6c1;color:#fff;}
.tabel-btn.edit:hover,.tabel-btn.hapus:hover {background:#e75480;}

/* Tombol Kuisioner */
.kuisioner-btn {margin-top:8px;padding:6px 10px;border-radius:8px;border:none;background:linear-gradient(45deg,#ff69b4,#e75480);color:#fff;font-weight:bold;cursor:pointer;transition:.3s;font-size:12px;}

footer {background:#ff69b4;color:#fff;padding:8px;font-family:'Pacifico',cursive;font-size:12px;margin-top:15px;border-radius:12px 12px 0 0;}

/* Notifikasi Copy Link */
#notif {
  position:fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  background:#ff69b4;
  color:#fff;
  padding:8px 14px;
  border-radius:12px;
  font-weight:bold;
  display:none;
  z-index:9999;
  box-shadow:0 2px 6px rgba(0,0,0,0.2);
  font-size:12px;
  opacity:0;
  transition:opacity 0.5s;
}

/* Responsive ultra compact */
@media(max-width:360px){
  h1 {font-size:1.4em;}
  input,button,.kuisioner-btn {width:88%;font-size:11px;padding:4px 6px;}
  .summary-box {font-size:10px;padding:4px;}
  table,th,td {font-size:9px;padding:2px;min-width:100%;}
  canvas {height:100px!important;}
  .btn-group button {font-size:10px;padding:2px 4px;}
  .tabel-btn {font-size:8px;padding:2px 4px;}
}
</style>
</head>

<body>
<div class="container" id="mainContainer">
  <h1>💖 Sweet Wallet 💖</h1>

  <!-- Form Input -->
  <form id="form">
    <input type="text" id="nama" placeholder="Nama Transaksi" required>
    <input type="number" id="jumlah" placeholder="Jumlah (Rp)" required>
    <button type="button" onclick="tambah('pemasukan')">+ Pemasukan</button>
    <button type="button" onclick="tambah('pengeluaran')">- Pengeluaran</button>
  </form>

  <!-- Ringkasan -->
  <div class="summary">
    <div class="summary-box">💵 Pemasukan: <span id="totalPemasukan">Rp 0</span></div>
    <div class="summary-box">💸 Pengeluaran: <span id="totalPengeluaran">Rp 0</span></div>
    <div class="summary-box">💰 Sisa: <span id="uangSisa">Rp 0</span></div>
    <div class="summary-box">🏦 Tabungan <br><button onclick="window.location.href='tabungan.html'">Rencana 💖</button></div>
  </div>

  <!-- Grafik & Tabel -->
  <div class="section-container">
    <div class="section-box">
      <div id="catatan" style="font-weight:600;color:#e75480;margin-bottom:3px;"></div>
      <canvas id="grafik"></canvas>
    </div>
    <div class="section-box">
      <div class="table-wrapper">
        <table>
          <thead>
            <tr>
              <th>No</th><th>Nama</th><th>Jumlah</th><th>Tipe</th><th>Aksi</th>
            </tr>
          </thead>
          <tbody id="tabel-body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Tombol Kuisioner -->
  <button class="kuisioner-btn" onclick="window.open('https://docs.google.com/forms/d/e/1FAIpQLSc2_TTHKmhutEuDpJVEV6MGPZ3cnZEZYGtFB6_d_fym86uCKg/viewform?usp=header')">💖 Kasih Rating 💖</button>

  <!-- Tombol Ekspor -->
  <div class="btn-group">
    <button onclick="downloadPDF()">📄 PDF</button>
    <button onclick="downloadExcel()">📊 Excel</button>
    <button class="shareimage" onclick="copyLink()">🔗 Copy Link</button>
    <button class="shareimage" onclick="saveAsImage()">🖼️ Simpan Gambar</button>
  </div>

  <!-- Tombol keluar -->
  <div style="margin-top:8px;">
    <button type="button" onclick="window.location.href='index.html'">🚪 Keluar</button>
  </div>
</div>

<!-- Notifikasi Copy -->
<div id="notif">Link berhasil disalin 💖</div>

<footer>💖 Sweet Wallet Compact 💖</footer>

<script>
let data=[];
const ctx=document.getElementById('grafik').getContext('2d');
let chart=new Chart(ctx,{
  type:'line',
  data:{labels:[],datasets:[{label:'Saldo Berjalan',data:[],borderColor:"#e75480",fill:false}]},
  options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:"#e75480"}}}}
});

function formatRupiah(angka){return "Rp "+angka.toLocaleString("id-ID");}

function tambah(tipe){
  const nama=document.getElementById('nama').value.trim();
  const jumlah=parseInt(document.getElementById('jumlah').value);
  if(!nama||isNaN(jumlah)){alert("Isi nama dan jumlah dulu ya sayangku💖");return;}
  data.push({nama,jumlah,tipe});
  document.getElementById('form').reset();
  update();
}

function update(){
  const body=document.getElementById('tabel-body');body.innerHTML="";
  let pemasukan=0,pengeluaran=0;
  data.forEach((d,i)=>{
    if(d.tipe==="pemasukan") pemasukan+=d.jumlah; else pengeluaran+=d.jumlah;
    body.innerHTML+=`
      <tr>
        <td>${i+1}</td>
        <td class="nama">${d.nama}</td>
        <td class="jumlah">${formatRupiah(d.jumlah)}</td>
        <td class="tipe">${d.tipe}</td>
        <td>
          <button class="tabel-btn edit" onclick="editRow(this,${i})">Edit</button>
          <button class="tabel-btn hapus" onclick="hapusData(${i})">Hapus</button>
        </td>
      </tr>`;
  });
  const sisa=pemasukan-pengeluaran;
  document.getElementById('totalPemasukan').innerText=formatRupiah(pemasukan);
  document.getElementById('totalPengeluaran').innerText=formatRupiah(pengeluaran);
  document.getElementById('uangSisa').innerText=formatRupiah(sisa);

  chart.data.labels=data.map((_,i)=>`T${i+1}`);
  chart.data.datasets[0].data=data.map((d,i)=>data.slice(0,i+1).reduce((sum,v)=>sum+(v.tipe==="pemasukan"?v.jumlah:-v.jumlah),0));
  chart.update();

  document.getElementById('catatan').innerText=pemasukan>pengeluaran?"💕 Jangan lupa di tabung sayangku💕":(pengeluaran>pemasukan?"💔 boros banget sih sayang x💔":"💗 tolong diprhatikan 💗");
}

function editRow(btn,index){
  const row=btn.parentElement.parentElement;
  const namaCell=row.querySelector(".nama");
  const jumlahCell=row.querySelector(".jumlah");
  const tipeCell=row.querySelector(".tipe");

  if(btn.innerText==="Edit"){
    namaCell.contentEditable="true";
    jumlahCell.contentEditable="true";
    const currentTipe=tipeCell.innerText;
    tipeCell.innerHTML=`<select>
      <option value="pemasukan" ${currentTipe==="pemasukan"?"selected":""}>pemasukan</option>
      <option value="pengeluaran" ${currentTipe==="pengeluaran"?"selected":""}>pengeluaran</option>
    </select>`;
    btn.innerText="Simpan";btn.style.background="#32cd32";
  } else {
    const nama=namaCell.innerText.trim();
    const jumlah=parseInt(jumlahCell.innerText.replace(/[^0-9]/g,""));
    const tipe=tipeCell.querySelector("select").value;
    if(!nama||isNaN(jumlah)){alert("Isi datanya yang valid dong sayang 💖");return;}
    data[index]={nama,jumlah,tipe};
    update();
    btn.innerText="Edit";btn.style.background="#ff69b4";
  }
}

function hapusData(i){data.splice(i,1);update();}

function downloadPDF(){
  const {jsPDF}=window.jspdf;const doc=new jsPDF();
  doc.setTextColor(231,84,128);doc.text("Laporan Keuangan 💖",10,10);
  let y=20;
  data.forEach((d,i)=>{doc.text(`${i+1}. ${d.nama} - ${formatRupiah(d.jumlah)} (${d.tipe})`,10,y);y+=6;});
  doc.save("laporan.pdf");
}

function downloadExcel(){
  let ws=XLSX.utils.json_to_sheet(data.map((d,i)=>{return {No:i+1,Nama:d.nama,Jumlah:formatRupiah(d.jumlah),Tipe:d.tipe};}));
  let wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,"Laporan");XLSX.writeFile(wb,"laporan.xlsx");
}

// Copy Link dengan popup custom
function copyLink(){
  navigator.clipboard.writeText(window.location.href).then(()=>{
    const notif=document.getElementById('notif');
    notif.style.display="block";
    notif.style.opacity="1";
    setTimeout(()=>{
      notif.style.opacity="0";
      setTimeout(()=>{notif.style.display="none";},500);
    },2000);
  });
}

function saveAsImage(){html2canvas(document.getElementById('mainContainer')).then(c=>{const link=document.createElement('a');link.href=c.toDataURL("image/png");link.download="laporan.png";link.click();});}

update();
</script>
</body>
</html>
