<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üíñ Aplikasi Keuangan Pink Cantik üíñ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;600&display=swap');

body { font-family:'Poppins',sans-serif; background:#ffe6f2; margin:0; padding:0; text-align:center; color:#333; }
h1 { font-family:'Pacifico',cursive; color:#e75480; font-size:2.8em; margin:20px 0; }
.container { max-width:950px; margin:auto; background:#fff; border-radius:25px; padding:25px; box-shadow:0 8px 20px rgba(231,84,128,0.3); }

form { display:flex; flex-wrap:wrap; justify-content:center; gap:10px; margin-bottom:20px; }
input { padding:12px 15px; border-radius:12px; border:1px solid #e75480; font-size:16px; min-width:150px; }
button { padding:12px 20px; border-radius:12px; border:none; background:linear-gradient(45deg,#ff69b4,#e75480); color:#fff; font-weight:bold; cursor:pointer; transition:all 0.3s ease; }
button:hover { transform:scale(1.05); background:linear-gradient(45deg,#e75480,#ff69b4); }

.summary { display:flex; justify-content:space-around; flex-wrap:wrap; gap:10px; margin-bottom:20px; }
.summary-box { flex:1; min-width:200px; background:#ffe4e1; color:#e75480; border-radius:15px; padding:15px; font-size:18px; font-weight:bold; box-shadow:0 4px 10px rgba(231,84,128,0.4); }

.section-container { display:flex; gap:15px; flex-wrap:wrap; margin-bottom:20px; }
.section-box { flex:1; min-width:300px; background:#fff0f7; border-radius:15px; padding:15px; box-shadow:0 4px 10px rgba(231,84,128,0.2); }

table { width:100%; border-collapse:collapse; border-radius:15px; overflow:hidden; margin-top:10px; font-size:14px; }
th, td { padding:10px; text-align:center; }
th { background:#ff69b4; color:#fff; font-size:14px; }
tr:nth-child(even) { background:#ffe6f2; }

canvas { width:100%; height:250px; margin-top:10px; }

.btn-group { margin-top:10px; display:flex; flex-wrap:wrap; justify-content:center; gap:10px; }
.btn-group button.pdfexcel { background:#ffb6c1; }
.btn-group button.shareimage { background:#8b0000; color:#fff; }

footer { background:#ff69b4; color:#fff; padding:15px; font-family:'Pacifico',cursive; font-size:18px; margin-top:30px; border-radius:15px 15px 0 0; }

/* Tombol aksi di tabel dengan efek tabung */
.tabel-btn { 
    padding:8px 14px; 
    border:none; 
    border-radius:20px; 
    margin:2px; 
    font-size:12px; 
    cursor:pointer; 
    font-weight:bold; 
    transition:0.3s; 
    box-shadow:0 2px 5px rgba(0,0,0,0.2);
}
.tabel-btn.edit { background:#ff69b4; color:#fff; }
.tabel-btn.edit:hover { background:#e75480; box-shadow:0 4px 8px rgba(0,0,0,0.3); }
.tabel-btn.hapus { background:#ffb6c1; color:#fff; }
.tabel-btn.hapus:hover { background:#e75480; box-shadow:0 4px 8px rgba(0,0,0,0.3); }

@media(max-width:768px) {
  .section-container { flex-direction:column; gap:15px; }
  .summary { flex-direction:column; gap:15px; }
  .summary-box { width:90%; margin:auto; font-size:16px; }
  input, button { width:90%; font-size:16px; }
  table, th, td { font-size:12px; }
  canvas { height:200px; }
}
</style>
</head>

<body>
<div class="container" id="mainContainer">
    <h1>üíñ Sweet Wallet üíñ</h1>

    <form id="form">
        <input type="text" id="nama" placeholder="Nama Transaksi" required>
        <input type="number" id="jumlah" placeholder="Jumlah (Rp)" required>
        <button type="button" onclick="tambah('pemasukan')">+ Pemasukan</button>
        <button type="button" onclick="tambah('pengeluaran')">- Pengeluaran</button>
    </form>

    <div class="summary">
        <div class="summary-box">üíµ Total Pemasukan: <span id="totalPemasukan">Rp 0</span></div>
        <div class="summary-box">üí∏ Total Pengeluaran: <span id="totalPengeluaran">Rp 0</span></div>
        <div class="summary-box">üí∞ Uang Sisa: <span id="uangSisa">Rp 0</span></div>
        <div class="summary-box">
            üè¶ Tabungan (Premium)<br>
            <button onclick="window.location.href='tabungan.html'">Rencana Menabung üíñ</button>
        </div>
    </div>

    <div class="section-container">
        <div class="section-box">
            <div id="catatan" style="font-weight:600; color:#e75480; margin-bottom:10px;"></div>
            <canvas id="grafik"></canvas>
        </div>

        <div class="section-box">
            <table>
                <thead>
                    <tr>
                        <th>No</th>
                        <th>Nama</th>
                        <th>Jumlah</th>
                        <th>Tipe</th>
                        <th>Saldo Berjalan</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="tabel-body"></tbody>
            </table>
        </div>
    </div>

    <div class="btn-group">
        <button class="pdfexcel" onclick="downloadPDF()">üìÑ Download PDF</button>
        <button class="pdfexcel" onclick="downloadExcel()">üìä Download Excel</button>
        <button class="shareimage" onclick="copyLink()">üîó Copy Link</button>
        <button class="shareimage" onclick="saveAsImage()">üñºÔ∏è Simpan Sebagai Gambar</button>
    </div>

    <div style="margin-top:10px;">
      <button type="button" onclick="window.location.href='landing.html'">Keluar</button>
    </div>
    
</div>

<footer>üíñ Aplikasi Keuangan Pink Cantik - Buat laporan keuanganmu lebih manis üíñ</footer>

<script>
let data=[];
const ctx=document.getElementById('grafik').getContext('2d');
let chart=new Chart(ctx,{ type:'line', data:{labels:[], datasets:[{label:'Saldo Berjalan', data:[], borderColor:"#e75480", fill:false}]}, options:{plugins:{legend:{labels:{color:"#e75480"}}}} });

function formatRupiah(angka){ return "Rp "+angka.toLocaleString("id-ID"); }

function tambah(tipe){
    const nama=document.getElementById('nama').value.trim();
    const jumlah=parseInt(document.getElementById('jumlah').value);
    if(!nama||isNaN(jumlah)){ alert("Isi nama dan jumlah dulu ya üíñ"); return; }
    data.push({nama,jumlah,tipe});
    document.getElementById('form').reset();
    update();
}

function update(){
    const body=document.getElementById('tabel-body');
    body.innerHTML="";
    let saldo=0,pemasukan=0,pengeluaran=0;
    let saldoArray=[];
    data.forEach((d,i)=>{
        saldo += (d.tipe==="pemasukan"?d.jumlah:-d.jumlah);
        saldoArray.push(saldo);
        if(d.tipe==="pemasukan") pemasukan+=d.jumlah; else pengeluaran+=d.jumlah;
        body.innerHTML+=`
<tr>
<td>${i+1}</td>
<td contenteditable="false" class="editable nama">${d.nama}</td>
<td contenteditable="false" class="editable jumlah">${d.jumlah}</td>
<td>${d.tipe}</td>
<td>${formatRupiah(saldo)}</td>
<td>
<button class="tabel-btn edit" onclick="editRow(this,${i})">Edit</button>
<button class="tabel-btn hapus" onclick="hapusData(${i})">Hapus</button>
</td>
</tr>`;
    });
    document.getElementById('totalPemasukan').innerText=formatRupiah(pemasukan);
    document.getElementById('totalPengeluaran').innerText=formatRupiah(pengeluaran);
    document.getElementById('uangSisa').innerText=formatRupiah(saldo);
    chart.data.labels=data.map((_,i)=>`T${i+1}`);
    chart.data.datasets[0].data=saldoArray;
    chart.update();
    let catatan="";
    if(pemasukan>pengeluaran) catatan="üíï Jangan lupa ditabung ya sayangku üíï";
    else if(pengeluaran>pemasukan) catatan="üíî Lebih hemat ya sayangku üíî";
    else catatan="üíó Pertahankan ya, jangan boros üíó";
    document.getElementById('catatan').innerText=catatan;
}

function editRow(btn,index){
    const row=btn.parentElement.parentElement;
    const namaCell=row.querySelector(".nama");
    const jumlahCell=row.querySelector(".jumlah");
    if(btn.innerText==="Edit"){
        namaCell.contentEditable="true";
        jumlahCell.contentEditable="true";
        namaCell.focus();
        btn.innerText="Simpan";
        btn.style.background="#32cd32";
    } else {
        const nama=namaCell.innerText.trim();
        const jumlah=parseInt(jumlahCell.innerText);
        if(!nama || isNaN(jumlah)){ alert("Isi nama dan jumlah valid"); return; }
        data[index].nama=nama;
        data[index].jumlah=jumlah;
        update();
    }
}

function hapusData(i){ data.splice(i,1); update(); }

function downloadPDF(){
    const { jsPDF }=window.jspdf;
    const doc=new jsPDF();
    doc.setTextColor(231,84,128);
    doc.text("Laporan Keuangan Pink üíñ",20,20);
    let y=30,saldo=0;
    data.forEach((d,i)=>{ saldo += (d.tipe==="pemasukan"?d.jumlah:-d.jumlah); doc.text(`${i+1}. ${d.nama} - ${formatRupiah(d.jumlah)} (${d.tipe}) | Saldo: ${formatRupiah(saldo)}`,20,y); y+=10; });
    doc.save("laporan.pdf");
}

function downloadExcel(){
    let saldo=0;
    let ws=XLSX.utils.json_to_sheet(data.map((d,i)=>{ saldo += (d.tipe==="pemasukan"?d.jumlah:-d.jumlah); return {No:i+1, Nama:d.nama, Jumlah:formatRupiah(d.jumlah), Tipe:d.tipe, "Saldo Berjalan":formatRupiah(saldo)}; }));
    let wb=XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb,ws,"Laporan");
    XLSX.writeFile(wb,"laporan.xlsx");
}

function copyLink(){ navigator.clipboard.writeText(window.location.href).then(()=>{ alert("Link halaman berhasil disalin üíñ"); }); }

function saveAsImage(){ html2canvas(document.getElementById('mainContainer')).then(canvas=>{ const link=document.createElement('a'); link.href=canvas.toDataURL("image/png"); link.download="laporan_keuangan.png"; link.click(); }); }

update();
</script>
</body>
</html>
