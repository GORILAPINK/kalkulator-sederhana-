<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>💖 Sweet Wallet Desktop 💖</title>

<!-- Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;600&display=swap');

body {
  font-family:'Poppins',sans-serif;
  background:#ffe6f2;
  margin:0;
  padding:0;
  color:#333;
}

/* Footer di atas */
footer {
  background:#ff69b4;
  color:#fff;
  padding:10px;
  font-family:'Pacifico',cursive;
  font-size:14px;
  border-radius:12px 12px 0 0;
  margin:10px 20px;
  text-align:center;
}

/* Container desktop */
.container {
  display:flex;
  max-width:1000px;
  margin:20px auto;
  background:pink;
  border-radius:15px;
  padding:12px;
  box-shadow:0 4px 12px rgba(231,84,128,0.3);
}

/* Sidebar kiri */
.sidebar {
  flex:1;
  max-width:250px;
  margin-right:12px;
}
.sidebar h1 {
  font-family:'Pacifico',cursive;
  color:#e75480;
  font-size:1.8em;
  margin:12px 0;
  text-align:center;
}

/* Summary Box */
.summary {
  display:grid;
  grid-template-columns: repeat(2,1fr);
  gap:6px;
  margin-bottom:10px;
}
.summary-box {
  background:#ffe4e1;
  color:#e75480;
  border-radius:10px;
  padding:6px;
  font-size:12px;
  font-weight:bold;
  box-shadow:0 2px 5px rgba(231,84,128,0.4);
  text-align:center;
}
.summary-box button {
  padding:2px 4px;
  font-size:10px;
  margin-top:4px;
}

/* Main content kanan */
.main-content {
  flex:2;
}

/* Form input */
.form-input {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:6px;
  margin-bottom:6px;
}
.form-input input {
  padding:8px;
  border-radius:8px;
  border:1px solid #e75480;
  font-size:14px;
}
.form-input button {
  padding:6px;
  border-radius:8px;
  border:none;
  background:linear-gradient(45deg,#ff69b4,#e75480);
  color:#fff;
  font-weight:bold;
  cursor:pointer;
  transition:.3s;
  font-size:14px;
}
.form-input button:hover {
  transform:scale(1.05);
  background:linear-gradient(45deg,#e75480,#ff69b4);
}

/* Section container */
.section-container {
  display:flex;
  flex-direction:column;
  gap:8px;
  margin-bottom:10px;
}
.section-box {
  background:#fff0f7;
  border-radius:10px;
  padding:8px;
  box-shadow:0 2px 5px rgba(231,84,128,0.2);
}

/* Table responsive */
.table-wrapper {
  width:100%;
  overflow-x:auto;
}
table {
  width:100%;
  border-collapse:collapse;
  font-size:11px;
}
th,td {
  padding:4px;
  text-align:center;
}
th {background:#ff69b4;color:#fff;}
tr:nth-child(even){background:#ffe6f2;}

/* Chart */
canvas {width:100%!important;height:200px!important;}

/* Tombol */
.btn-group {
  display:grid;
  gap:6px;
  margin-top:8px;
}
.btn-group .top-row {
  display:grid;
  grid-template-columns: repeat(2,1fr);
  gap:6px;
}
.btn-group .bottom-row {
  display:grid;
  grid-template-columns: repeat(4,1fr);
  gap:6px;
}
.btn-group button {
  padding:6px;
  font-size:13px;
  border-radius:8px;
  cursor:pointer;
}
.btn-group button.shareimage {background:#8b0000;color:#fff;}

/* Tombol tabel */
.tabel-btn {
  padding:3px 6px;
  border:none;
  border-radius:12px;
  margin:1px;
  font-size:10px;
  cursor:pointer;
  font-weight:bold;
}
.tabel-btn.edit {background:#ff69b4;color:#fff;}
.tabel-btn.hapus {background:#ffb6c1;color:#fff;}
.tabel-btn.edit:hover,.tabel-btn.hapus:hover {background:#e75480;}

/* Notifikasi Copy */
#notif {
  position:fixed;
  top:20px;
  left:50%;
  transform:translateX(-50%);
  background:#ff69b4;
  color:#fff;
  padding:8px 14px;
  border-radius:12px;
  font-weight:bold;
  display:none;
  z-index:9999;
  font-size:12px;
  opacity:0;
  transition:opacity 0.5s;
}

/* Responsif */
@media(max-width:1024px){
  .container {flex-direction:column;}
  .sidebar {margin-right:0;max-width:100%;}
}
@media(max-width:420px){
  .form-input input, .form-input button {font-size:13px; padding:6px;}
  .summary-box {font-size:11px;}
  table,th,td {font-size:10px; padding:3px;}
  canvas {height:150px!important;}
}
</style>
</head>

<body>
<footer>💖 Sweet Wallet Desktop 💖</footer>

<div class="container" id="mainContainer">
  <!-- Sidebar kiri -->
  <div class="sidebar">
    <h1>💖 Sweet Wallet 💖</h1>
    <div class="summary">
      <div class="summary-box">💵 Pemasukan: <span id="totalPemasukan">Rp 0</span></div>
      <div class="summary-box">💸 Pengeluaran: <span id="totalPengeluaran">Rp 0</span></div>
      <div class="summary-box">💰 Sisa: <span id="uangSisa">Rp 0</span></div>
      <div class="summary-box">🏦 Tabungan <br><button onclick="window.location.href='tabungan.html'">langganan 💖</button></div>
    </div>
  </div>

  <!-- Main content kanan -->
  <div class="main-content">
    <div class="section-container">
      <!-- Form input di atas tabel -->
      <div class="section-box form-input">
        <input type="text" id="nama" placeholder="Nama Transaksi" required>
        <input type="number" id="jumlah" placeholder="Jumlah (Rp)" required>
        <button type="button" onclick="tambah('pemasukan')">+ Pemasukan</button>
        <button type="button" onclick="tambah('pengeluaran')">- Pengeluaran</button>
      </div>

      <!-- Catatan & Grafik -->
      <div class="section-box">
        <div id="catatan" style="font-weight:600;color:#e75480;margin-bottom:3px;"></div>
        <canvas id="grafik"></canvas>
      </div>

      <!-- Tabel -->
      <div class="section-box">
        <div class="table-wrapper">
          <table>
            <thead>
              <tr><th>No</th><th>Nama</th><th>Jumlah</th><th>Tipe</th><th>Aksi</th></tr>
            </thead>
            <tbody id="tabel-body"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Tombol -->
    <div class="btn-group">
      <div class="top-row">
        <button onclick="window.open('https://docs.google.com/forms/d/e/1FAIpQLScCZyvDNLlInoZhQbnXtbAOygswTLThcjitfgg1key-1pZ_TA/viewform?usp=header')">💖 Kasih Rating 💖</button>
        <button onclick="window.location.href='index.html'">🚪 Keluar</button>
      </div>
      <div class="bottom-row">
        <button onclick="downloadPDF()">📄 PDF</button>
        <button onclick="downloadExcel()">📊 Excel</button>
        <button class="shareimage" onclick="copyLink()">🔗 Copy Link</button>
        <button class="shareimage" onclick="saveAsImage()">🖼️ Simpan Gambar</button>
      </div>
    </div>
  </div>
</div>

<div id="notif">Link berhasil disalin 💖</div>

<script>
let data=[];
const ctx=document.getElementById('grafik').getContext('2d');
let chart=new Chart(ctx,{
  type:'line',
  data:{labels:[],datasets:[{label:'Saldo Berjalan',data:[],borderColor:"#e75480",fill:false}]},
  options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:"#e75480"}}}}
});

function formatRupiah(angka){return "Rp "+angka.toLocaleString("id-ID");}

function tambah(tipe){
  const nama=document.getElementById('nama').value.trim();
  const jumlah=parseInt(document.getElementById('jumlah').value);
  if(!nama||isNaN(jumlah)){alert("Isi nama dan jumlah dulu ya sayangku💖");return;}
  data.push({nama,jumlah,tipe});
  document.getElementById('nama').value="";
  document.getElementById('jumlah').value="";
  update();
}

function update(){
  const body=document.getElementById('tabel-body');body.innerHTML="";
  let pemasukan=0,pengeluaran=0;
  data.forEach((d,i)=>{
    if(d.tipe==="pemasukan") pemasukan+=d.jumlah; else pengeluaran+=d.jumlah;
    body.innerHTML+=`
      <tr>
        <td>${i+1}</td>
        <td class="nama">${d.nama}</td>
        <td class="jumlah">${formatRupiah(d.jumlah)}</td>
        <td class="tipe">${d.tipe}</td>
        <td>
          <button class="tabel-btn edit" onclick="editRow(this,${i})">Edit</button>
          <button class="tabel-btn hapus" onclick="hapusData(${i})">Hapus</button>
        </td>
      </tr>`;
  });
  const sisa=pemasukan-pengeluaran;
  document.getElementById('totalPemasukan').innerText=formatRupiah(pemasukan);
  document.getElementById('totalPengeluaran').innerText=formatRupiah(pengeluaran);
  document.getElementById('uangSisa').innerText=formatRupiah(sisa);

  chart.data.labels=data.map((_,i)=>`T${i+1}`);
  chart.data.datasets[0].data=data.map((d,i)=>data.slice(0,i+1).reduce((sum,v)=>sum+(v.tipe==="pemasukan"?v.jumlah:-v.jumlah),0));
  chart.update();

  document.getElementById('catatan').innerText=pemasukan>pengeluaran?"💕 Jangan lupa di tabung sayangku💕":(pengeluaran>pemasukan?"💔 Boros banget 💔":"💗 Mulai kelola yang cermat 💗");
}

function editRow(btn,index){
  const row=btn.parentElement.parentElement;
  const namaCell=row.querySelector(".nama");
  const jumlahCell=row.querySelector(".jumlah");
  const tipeCell=row.querySelector(".tipe");

  if(btn.innerText==="Edit"){
    namaCell.contentEditable="true";
    jumlahCell.contentEditable="true";
    const currentTipe=tipeCell.innerText;
    tipeCell.innerHTML=`<select>
      <option value="pemasukan" ${currentTipe==="pemasukan"?"selected":""}>pemasukan</option>
      <option value="pengeluaran" ${currentTipe==="pengeluaran"?"selected":""}>pengeluaran</option>
    </select>`;
    btn.innerText="Simpan";btn.style.background="#32cd32";
  } else {
    const nama=namaCell.innerText.trim();
    const jumlah=parseInt(jumlahCell.innerText.replace(/[^0-9]/g,""));
    const tipe=tipeCell.querySelector("select").value;
    if(!nama||isNaN(jumlah)){alert("Isi datanya yang valid dong sayang 💖");return;}
    data[index]={nama,jumlah,tipe};
    update();
    btn.innerText="Edit";btn.style.background="#ff69b4";
  }
}

function hapusData(i){data.splice(i,1);update();}

function downloadPDF(){
  const {jsPDF}=window.jspdf;const doc=new jsPDF();
  doc.setTextColor(231,84,128);doc.text("Laporan Keuangan 💖",10,10);
  let y=20;
  data.forEach((d,i)=>{doc.text(`${i+1}. ${d.nama} - ${formatRupiah(d.jumlah)} (${d.tipe})`,10,y);y+=6;});
  doc.save("laporan.pdf");
}

function downloadExcel(){
  let ws=XLSX.utils.json_to_sheet(data.map((d,i)=>{return {No:i+1,Nama:d.nama,Jumlah:formatRupiah(d.jumlah),Tipe:d.tipe};}));
  let wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,"Laporan");XLSX.writeFile(wb,"laporan.xlsx");
}

function copyLink(){
  navigator.clipboard.writeText(window.location.href).then(()=>{
    const notif=document.getElementById('notif');
    notif.style.display="block";
    notif.style.opacity="1";
    setTimeout(()=>{notif.style.opacity="0";setTimeout(()=>{notif.style.display="none";},500);},2000);
  });
}

function saveAsImage(){
  html2canvas(document.getElementById('mainContainer')).then(c=>{
    const link=document.createElement('a');
    link.href=c.toDataURL("image/png");
    link.download="laporan.png";
    link.click();
  });
}

update();
</script>
</body>
</html>
